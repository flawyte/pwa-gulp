<html><head><link rel="import" href="../utils/boot.html"><link rel="import" href="../utils/array-splice.html"><link rel="import" href="../utils/async.html"><script>"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,s,n){return s&&e(t.prototype,s),n&&e(t,n),t}}();!function(){function e(e){return"slot"===e.localName}var t=function(){function t(e,s){var n=this;_classCallCheck(this,t),this._shadyChildrenObserver=null,this._nativeChildrenObserver=null,this._connected=!1,this._target=e,this.callback=s,this._effectiveNodes=[],this._observer=null,this._scheduled=!1,this._boundSchedule=function(){n._schedule()},this.connect(),this._schedule()}return _createClass(t,null,[{key:"getFlattenedNodes",value:function(t){return e(t)?t.assignedNodes({flatten:!0}):Array.from(t.childNodes).map(function(t){return e(t)?t.assignedNodes({flatten:!0}):[t]}).reduce(function(e,t){return e.concat(t)},[])}}]),_createClass(t,[{key:"connect",value:function(){var t=this;e(this._target)?this._listenSlots([this._target]):(this._listenSlots(this._target.children),window.ShadyDOM?this._shadyChildrenObserver=ShadyDOM.observeChildren(this._target,function(e){t._processMutations(e)}):(this._nativeChildrenObserver=new MutationObserver(function(e){t._processMutations(e)}),this._nativeChildrenObserver.observe(this._target,{childList:!0}))),this._connected=!0}},{key:"disconnect",value:function(){e(this._target)?this._unlistenSlots([this._target]):(this._unlistenSlots(this._target.children),window.ShadyDOM&&this._shadyChildrenObserver?(ShadyDOM.unobserveChildren(this._shadyChildrenObserver),this._shadyChildrenObserver=null):this._nativeChildrenObserver&&(this._nativeChildrenObserver.disconnect(),this._nativeChildrenObserver=null)),this._connected=!1}},{key:"_schedule",value:function(){var e=this;this._scheduled||(this._scheduled=!0,Polymer.Async.microTask.run(function(){return e.flush()}))}},{key:"_processMutations",value:function(e){this._processSlotMutations(e),this.flush()}},{key:"_processSlotMutations",value:function(e){if(e)for(var t=0;t<e.length;t++){var s=e[t];s.addedNodes&&this._listenSlots(s.addedNodes),s.removedNodes&&this._unlistenSlots(s.removedNodes)}}},{key:"flush",value:function(){if(!this._connected)return!1;window.ShadyDOM&&ShadyDOM.flush(),this._nativeChildrenObserver?this._processSlotMutations(this._nativeChildrenObserver.takeRecords()):this._shadyChildrenObserver&&this._processSlotMutations(this._shadyChildrenObserver.takeRecords()),this._scheduled=!1;for(var e,t={target:this._target,addedNodes:[],removedNodes:[]},s=this.constructor.getFlattenedNodes(this._target),n=Polymer.ArraySplice.calculateSplices(s,this._effectiveNodes),r=0;r<n.length&&(e=n[r]);r++)for(var i,o=0;o<e.removed.length&&(i=e.removed[o]);o++)t.removedNodes.push(i);for(var h,l=0;l<n.length&&(h=n[l]);l++)for(var a=h.index;a<h.index+h.addedCount;a++)t.addedNodes.push(s[a]);this._effectiveNodes=s;var d=!1;return(t.addedNodes.length||t.removedNodes.length)&&(d=!0,this.callback.call(this._target,t)),d}},{key:"_listenSlots",value:function(t){for(var s=0;s<t.length;s++){var n=t[s];e(n)&&n.addEventListener("slotchange",this._boundSchedule)}}},{key:"_unlistenSlots",value:function(t){for(var s=0;s<t.length;s++){var n=t[s];e(n)&&n.removeEventListener("slotchange",this._boundSchedule)}}}]),t}();Polymer.FlattenedNodesObserver=t}();</script></head><body></body></html>