<html><head><link rel="import" href="../../polymer-element.html"><link rel="import" href="../utils/mixin.html"><link rel="import" href="../utils/array-splice.html"><script>"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}();!function(){var e=Polymer.dedupingMixin(function(e){var t=Polymer.ElementMixin(e);return function(e){function s(){_classCallCheck(this,s);var e=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return e.__lastItems=null,e.__lastMulti=null,e.__selectedMap=null,e}return _inherits(s,t),_createClass(s,null,[{key:"properties",get:function(){return{items:{type:Array},multi:{type:Boolean,value:!1},selected:{type:Object,notify:!0},selectedItem:{type:Object,notify:!0},toggle:{type:Boolean,value:!1}}}},{key:"observers",get:function(){return["__updateSelection(multi, items.*)"]}}]),_createClass(s,[{key:"__updateSelection",value:function(e,t){var s=t.path;if("items"==s){var i=t.base||[],l=this.__lastItems;if(e!==this.__lastMulti&&this.clearSelection(),l){var n=Polymer.ArraySplice.calculateSplices(i,l);this.__applySplices(n)}this.__lastItems=i,this.__lastMulti=e}else if("items.splices"==t.path)this.__applySplices(t.value.indexSplices);else{var r=s.slice("items.".length),a=parseInt(r,10);r.indexOf(".")<0&&r==a&&this.__deselectChangedIdx(a)}}},{key:"__applySplices",value:function(e){for(var t=this,s=this.__selectedMap,i=0;i<e.length;i++)!function(i){var l=e[i];s.forEach(function(e,t){e<l.index||(e>=l.index+l.removed.length?s.set(t,e+l.addedCount-l.removed.length):s.set(t,-1))});for(var n=0;n<l.addedCount;n++){var r=l.index+n;s.has(t.items[r])&&s.set(t.items[r],r)}}(i);this.__updateLinks();var l=0;s.forEach(function(e,i){e<0?(t.multi?t.splice("selected",l,1):t.selected=t.selectedItem=null,s.delete(i)):l++})}},{key:"__updateLinks",value:function(){var e=this;if(this.__dataLinkedPaths={},this.multi){var t=0;this.__selectedMap.forEach(function(s){s>=0&&e.linkPaths("items."+s,"selected."+t++)})}else this.__selectedMap.forEach(function(t){e.linkPaths("selected","items."+t),e.linkPaths("selectedItem","items."+t)})}},{key:"clearSelection",value:function(){this.__dataLinkedPaths={},this.__selectedMap=new Map,this.selected=this.multi?[]:null,this.selectedItem=null}},{key:"isSelected",value:function(e){return this.__selectedMap.has(e)}},{key:"isIndexSelected",value:function(e){return this.isSelected(this.items[e])}},{key:"__deselectChangedIdx",value:function(e){var t=this,s=this.__selectedIndexForItemIndex(e);if(s>=0){var i=0;this.__selectedMap.forEach(function(e,l){s==i++&&t.deselect(l)})}}},{key:"__selectedIndexForItemIndex",value:function(e){var t=this.__dataLinkedPaths["items."+e];if(t)return parseInt(t.slice("selected.".length),10)}},{key:"deselect",value:function(e){var t=this.__selectedMap.get(e);if(t>=0){this.__selectedMap.delete(e);var s=void 0;this.multi&&(s=this.__selectedIndexForItemIndex(t)),this.__updateLinks(),this.multi?this.splice("selected",s,1):this.selected=this.selectedItem=null}}},{key:"deselectIndex",value:function(e){this.deselect(this.items[e])}},{key:"select",value:function(e){this.selectIndex(this.items.indexOf(e))}},{key:"selectIndex",value:function(e){var t=this.items[e];this.isSelected(t)?this.toggle&&this.deselectIndex(e):(this.multi||this.__selectedMap.clear(),this.__selectedMap.set(t,e),this.__updateLinks(),this.multi?this.push("selected",t):this.selected=this.selectedItem=t)}}]),s}()});Polymer.ArraySelectorMixin=e;var t=e(Polymer.Element),s=function(e){function s(){return _classCallCheck(this,s),_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}return _inherits(s,t),_createClass(s,null,[{key:"is",get:function(){return"array-selector"}}]),s}();customElements.define(s.is,s),Polymer.ArraySelector=s}();</script></head><body></body></html>